# Phase 1 ÌïµÏã¨ Saga ÏÑ§Í≥Ñ

Ïù¥ Î¨∏ÏÑúÎäî **ÏïåÍ≥†Î¶¨Ìè¨Ìä∏ Phase 1ÏóêÏÑú Íµ¨ÌòÑÌï¥Ïïº ÌïòÎäî 6Í∞ú ÌïµÏã¨ Saga**Ïùò ÏÉÅÏÑ∏ ÏÑ§Í≥ÑÎ•º Îã§Î£πÎãàÎã§. Ïù¥Îì§ÏùÄ ÌîåÎû´ÌèºÏùò Í∏∞Î≥∏ Í∏∞Îä•ÏùÑ ÏúÑÌï¥ Î∞òÎìúÏãú ÌïÑÏöîÌïú Î∂ÑÏÇ∞ Ìä∏ÎûúÏû≠ÏÖòÎì§ÏûÖÎãàÎã§.

---

## üéØ **Phase 1 Saga Í∞úÏöî**

| ÏàúÏÑú | Saga Ïù¥Î¶Ñ | Î≥µÏû°ÎèÑ | Ìä∏Î¶¨Í±∞ | Í¥ÄÎ†® Î™®Îìà | Íµ¨ÌòÑ Ïö∞ÏÑ†ÏàúÏúÑ |
|-----|----------|-------|--------|----------|-------------|
| 1 | `INITIAL_DATA_SYNC_SAGA` | Very High | solved.ac Ïó∞Îèô | User, Analysis, StudyGroup, Notification | üî• Critical |
| 2 | `USER_REGISTRATION_SAGA` | Medium | OAuth2 Î°úÍ∑∏Ïù∏ | User, Analysis, Notification | üî• Critical |
| 3 | `SOLVEDAC_LINK_SAGA` | High | ÏÇ¨Ïö©Ïûê ÏöîÏ≤≠ | User, Analysis, StudyGroup, Notification | üî• Critical |
| 4 | `CREATE_GROUP_SAGA` | Medium | ÏÇ¨Ïö©Ïûê ÏöîÏ≤≠ | StudyGroup, User, Analysis, Notification | üî• Critical |
| 5 | `JOIN_GROUP_SAGA` | High | ÏÇ¨Ïö©Ïûê ÏöîÏ≤≠ | StudyGroup, User, Analysis, Notification | üî• Critical |
| 6 | `SUBMISSION_SYNC_SAGA` | Medium | Ïä§ÏºÄÏ§ÑÎü¨ | Analysis, StudyGroup, Notification | üü° Important |
| 7 | `ANALYSIS_UPDATE_SAGA` | Medium | Ïä§ÏºÄÏ§ÑÎü¨ | Analysis, StudyGroup, Notification | üü° Important |

---

## üìã **ÏÉÅÏÑ∏ Saga ÏÑ§Í≥Ñ**

### **1. INITIAL_DATA_SYNC_SAGA**

**Î™©Ìëú**: solved.ac Í≥ÑÏ†ï Ïó∞Îèô Ïãú Í≥ºÍ±∞ Îç∞Ïù¥ÌÑ∞ ÎåÄÎüâ ÏàòÏßë Î∞è Ï¥àÍ∏∞ Î∂ÑÏÑù ÌôòÍ≤Ω Íµ¨Ï∂ï

#### **ÎπÑÏ¶àÎãàÏä§ ÏöîÍµ¨ÏÇ¨Ìï≠**
- solved.ac Ïó∞Îèô Ïãú **Í≥ºÍ±∞ 6Í∞úÏõîÍ∞Ñ** Î™®Îì† Ï†úÏ∂ú Ïù¥Î†• ÏàòÏßë
- **ÎåÄÏö©Îüâ Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨**Î•º ÏúÑÌïú Î∞∞Ïπò ÏûëÏóÖ Í¥ÄÎ¶¨
- **Ï†êÏßÑÏ†Å Îç∞Ïù¥ÌÑ∞ ÏàòÏßë**ÏúºÎ°ú API Î†àÏù¥Ìä∏ Î¶¨Î∞ã Ï§ÄÏàò
- ÏàòÏßë ÏßÑÌñâ ÏÉÅÌô© Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º
- **Ïã§Ìå® Ïãú Î∂ÄÎ∂Ñ Î≥µÍµ¨** Í∞ÄÎä•Ìïú Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏ ÏãúÏä§ÌÖú

#### **Saga ÌùêÎ¶ÑÎèÑ**

```mermaid
sequenceDiagram
    participant Client
    participant U as User Module
    participant API as solved.ac API
    participant A as Analysis Module
    participant SG as StudyGroup Module
    participant N as Notification Module
    participant K as Kafka

    Note over Client,K: üîÑ INITIAL_DATA_SYNC_SAGA (Í∞ÄÏû• Î≥µÏû°Ìïú Îç∞Ïù¥ÌÑ∞ ÏàòÏßë Saga)
    
    Client->>U: POST /users/me/link-solvedac {handle, syncPeriod}
    
    rect rgb(255, 240, 240)
        Note over U: Step 1: Ïó∞Îèô Ï§ÄÎπÑ Î∞è ÏàòÏßë Í≥ÑÌöç ÏàòÎ¶Ω
        U->>API: solved.ac ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï°∞Ìöå
        API-->>U: {handle, tier, solvedCount, ...}
        U->>U: ÏàòÏßë ÎåÄÏÉÅ Î¨∏Ï†ú Ïàò ÏòàÏÉÅ (ÏµúÍ∑º 6Í∞úÏõî)
        U->>U: Î∞∞Ïπò ÏûëÏóÖ Í≥ÑÌöç ÏàòÎ¶Ω (100Í∞úÏî© ÎÇòÎàÑÏñ¥ ÏàòÏßë)
        U->>U: SyncJob ÏÉùÏÑ± Î∞è Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏ Ï¥àÍ∏∞Ìôî
        U->>U: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        U-->>K: DATA_SYNC_INITIATED Î∞úÌñâ
    end
    
    rect rgb(240, 255, 240)
        Note over A: Step 2: Î∞∞Ïπò Îç∞Ïù¥ÌÑ∞ ÏàòÏßë ÏãúÏûë
        K->>A: DATA_SYNC_INITIATED ÏàòÏã†
        A->>A: ÏàòÏßë ÏûëÏóÖ Ïä§ÏºÄÏ§Ñ ÏÉùÏÑ±
        loop Î∞∞ÏπòÎ≥Ñ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë (100Í∞úÏî©)
            A->>API: Ï†úÏ∂ú Ïù¥Î†• Ï°∞Ìöå (pageSize=100)
            API-->>A: submissions[] (Î∞∞Ïπò)
            A->>A: Submissions Í≤ÄÏ¶ù Î∞è Ï†ÄÏû•
            A->>A: Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            A->>A: ÏßÑÌñâÎ•† Í≥ÑÏÇ∞ Î∞è Ï†ÄÏû•
            
            alt API Î†àÏù¥Ìä∏ Î¶¨Î∞ã ÎèÑÎã¨
                A->>A: 1Î∂Ñ ÎåÄÍ∏∞ ÌõÑ Ïû¨ÏãúÎèÑ
            else ÏùºÏãúÏ†Å Ïò§Î•ò
                A->>A: ÏßÄÏàò Î∞±Ïò§ÌîÑÎ°ú Ïû¨ÏãúÎèÑ (ÏµúÎåÄ 3Ìöå)
            end
        end
        A->>A: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: HISTORICAL_DATA_COLLECTED Î∞úÌñâ
    end
    
    rect rgb(240, 240, 255)
        Note over A: Step 3: Ï¥àÍ∏∞ Î∂ÑÏÑù Ïã§Ìñâ
        K->>A: HISTORICAL_DATA_COLLECTED ÏàòÏã† (ÏûêÏ≤¥ Ï≤òÎ¶¨)
        A->>A: ÏàòÏßëÎêú Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò Ï¥àÍ∏∞ Î∂ÑÏÑù Ïã§Ìñâ
        A->>A: ÌÉúÍ∑∏Î≥Ñ ÏàôÎ†®ÎèÑ Í≥ÑÏÇ∞
        A->>A: Ï∑®ÏïΩÏ†ê/Í∞ïÏ†ê Î∂ÑÏÑù
        A->>A: Î¨∏Ï†ú Ìï¥Í≤∞ Ìå®ÌÑ¥ Î∂ÑÏÑù
        A->>A: Ï∂îÏ≤ú ÏãúÏä§ÌÖú Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Íµ¨Ï∂ï
        A->>A: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: INITIAL_ANALYSIS_COMPLETED Î∞úÌñâ
    end
    
    rect rgb(255, 240, 255)
        Note over SG: Step 4: Í∑∏Î£π ÌîÑÎ°úÌïÑ ÎèôÍ∏∞Ìôî
        K->>SG: INITIAL_ANALYSIS_COMPLETED ÏàòÏã†
        SG->>SG: ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÜçÌïú Í∑∏Î£πÎì§ Ï°∞Ìöå
        loop Í∞Å Í∑∏Î£πÎ≥ÑÎ°ú
            SG->>SG: Î©§Î≤Ñ ÌîÑÎ°úÌïÑ ÏóÖÎç∞Ïù¥Ìä∏
            SG->>SG: Í∑∏Î£π ÌÜµÍ≥Ñ Ïû¨Í≥ÑÏÇ∞
        end
        SG->>SG: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        SG-->>K: GROUP_PROFILES_SYNCHRONIZED Î∞úÌñâ
    end
    
    rect rgb(255, 255, 240)
        Note over N: Step 5: ÎèôÍ∏∞Ìôî ÏôÑÎ£å ÏïåÎ¶º
        K->>N: GROUP_PROFILES_SYNCHRONIZED ÏàòÏã†
        N->>N: ÎèôÍ∏∞Ìôî ÏôÑÎ£å ÏïåÎ¶º ÏÉùÏÑ±
        N->>N: Ï¥àÍ∏∞ Î∂ÑÏÑù Í≤∞Í≥º ÏöîÏïΩ ÏïåÎ¶º
        N->>N: Ï∂îÏ≤ú Î¨∏Ï†ú Î™©Î°ù ÏïåÎ¶º
        N->>N: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        N-->>K: SYNC_COMPLETION_NOTIFICATIONS_SENT Î∞úÌñâ
    end
    
    U-->>Client: ÎèôÍ∏∞Ìôî ÏãúÏûë ÏùëÎãµ (ÎπÑÎèôÍ∏∞ Ï≤òÎ¶¨ Ï§ë)
```

#### **Ïù¥Î≤§Ìä∏ Î™ÖÏÑ∏**

##### `DATA_SYNC_INITIATED`
```json
{
  "eventType": "DATA_SYNC_INITIATED",
  "aggregateId": "sync-job-{uuid}",
  "sagaId": "{saga-uuid}",
  "data": {
    "userId": "{uuid}",
    "solvedacHandle": "algosolver",
    "syncPeriodMonths": 6,
    "estimatedSubmissions": 450,
    "batchSize": 100,
    "syncJobId": "{uuid}",
    "priority": "HIGH"
  }
}
```

##### `HISTORICAL_DATA_COLLECTED`
```json
{
  "eventType": "HISTORICAL_DATA_COLLECTED",
  "aggregateId": "sync-job-{uuid}",
  "sagaId": "{saga-uuid}",
  "data": {
    "userId": "{uuid}",
    "syncJobId": "{uuid}",
    "collectedSubmissions": 387,
    "collectedProblems": 245,
    "syncDurationMinutes": 23,
    "dataQualityScore": 0.98,
    "collectionStats": {
      "totalBatches": 4,
      "successfulBatches": 4,
      "failedBatches": 0,
      "retryCount": 2
    }
  }
}
```

##### `INITIAL_ANALYSIS_COMPLETED`
```json
{
  "eventType": "INITIAL_ANALYSIS_COMPLETED",
  "aggregateId": "analysis-{uuid}",
  "sagaId": "{saga-uuid}",
  "data": {
    "userId": "{uuid}",
    "analysisId": "{uuid}",
    "currentTier": "gold3",
    "strongTags": ["implementation", "math", "string"],
    "weakTags": ["dp", "graph", "tree"],
    "solvedProblems": 387,
    "averageDifficulty": "silver2",
    "streakDays": 45,
    "recommendedNextTier": "gold2"
  }
}
```

#### **Î≥µÏû°Ìïú Î≥¥ÏÉÅ Ìä∏ÎûúÏû≠ÏÖò**

```mermaid
sequenceDiagram
    participant U as User Module
    participant A as Analysis Module
    participant SG as StudyGroup Module
    participant K as Kafka

    Note over U,K: üí• Step 2 Ïã§Ìå® ÏãúÎÇòÎ¶¨Ïò§ (ÎåÄÏö©Îüâ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë Ïã§Ìå®)
    
    rect rgb(255, 200, 200)
        Note over A: Îç∞Ïù¥ÌÑ∞ ÏàòÏßë Ï§ë Ïã¨Í∞ÅÌïú Ïò§Î•ò Î∞úÏÉù
        A->>A: collectHistoricalData() [API ÏÑúÎ≤Ñ Îã§Ïö¥]
        A->>A: Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏ ÌôïÏù∏ (70% ÏôÑÎ£åÎê®)
        A->>A: OutboxÏóê Ïã§Ìå® Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: HISTORICAL_DATA_COLLECTION_FAILED Î∞úÌñâ
    end
    
    rect rgb(255, 200, 200)
        Note over U: Î≥¥ÏÉÅ 1: Î∂ÄÎ∂Ñ ÏàòÏßë Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨
        K->>U: HISTORICAL_DATA_COLLECTION_FAILED ÏàòÏã†
        U->>U: ÏßÑÌñâ Ï§ëÏù∏ SyncJob ÏÉÅÌÉú ÌôïÏù∏
        alt 70% Ïù¥ÏÉÅ ÏôÑÎ£åÎêú Í≤ΩÏö∞
            U->>U: Î∂ÄÎ∂Ñ Îç∞Ïù¥ÌÑ∞ Î≥¥Ï°¥ (ÎÇòÏ§ëÏóê Ïû¨ÏãúÏûë Í∞ÄÎä•)
            U->>U: SyncJob ÏÉÅÌÉúÎ•º PARTIALLY_COMPLETEDÎ°ú Î≥ÄÍ≤Ω
        else 30% ÎØ∏ÎßåÏù∏ Í≤ΩÏö∞
            U->>U: ÏàòÏßëÎêú Îç∞Ïù¥ÌÑ∞ Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
            U->>U: SyncJob ÏÉÅÌÉúÎ•º FAILEDÎ°ú Î≥ÄÍ≤Ω
        end
        U->>U: OutboxÏóê Î≥¥ÏÉÅ Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        U-->>K: DATA_SYNC_COMPENSATED Î∞úÌñâ
    end
    
    rect rgb(255, 200, 200)
        Note over A: Î≥¥ÏÉÅ 2: Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨
        K->>A: DATA_SYNC_COMPENSATED ÏàòÏã†
        A->>A: ÏÉùÏÑ±Îêú Î∂ÄÎ∂Ñ Î∂ÑÏÑù Í≤∞Í≥º Ï†ïÎ¶¨
        A->>A: Ï∂îÏ≤ú Ï∫êÏãú Î¨¥Ìö®Ìôî
        A->>A: OutboxÏóê Î≥¥ÏÉÅ Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: ANALYSIS_DATA_REVERTED Î∞úÌñâ
    end
    
    rect rgb(255, 200, 200)
        Note over SG: Î≥¥ÏÉÅ 3: Í∑∏Î£π ÌîÑÎ°úÌïÑ Î≥µÏõê
        K->>SG: ANALYSIS_DATA_REVERTED ÏàòÏã†
        SG->>SG: ÏóÖÎç∞Ïù¥Ìä∏Îêú Î©§Î≤Ñ ÌîÑÎ°úÌïÑ Ïù¥Ï†Ñ ÏÉÅÌÉúÎ°ú Î≥µÏõê
        SG->>SG: Í∑∏Î£π ÌÜµÍ≥Ñ Ïû¨Í≥ÑÏÇ∞
        SG->>SG: OutboxÏóê Î≥¥ÏÉÅ Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        SG-->>K: GROUP_PROFILES_REVERTED Î∞úÌñâ
    end
```

#### **Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏ Í∏∞Î∞ò Î≥µÍµ¨ ÏãúÏä§ÌÖú**

```kotlin
data class DataSyncCheckpoint(
    val syncJobId: UUID,
    val userId: UUID,
    val currentBatch: Int,
    val totalBatches: Int,
    val lastProcessedSubmissionId: Long,
    val collectedCount: Int,
    val failedAttempts: Int,
    val checkpointAt: LocalDateTime,
    val canResume: Boolean
)

@Service
class DataSyncRecoveryService {
    
    fun resumeFromCheckpoint(syncJobId: UUID): Boolean {
        val checkpoint = checkpointRepository.findBySyncJobId(syncJobId)
            ?: return false
            
        if (!checkpoint.canResume || checkpoint.failedAttempts > 3) {
            return false
        }
        
        // Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏Î∂ÄÌÑ∞ Ïû¨ÏãúÏûë
        dataCollectionService.resumeCollection(
            syncJobId = checkpoint.syncJobId,
            startFromBatch = checkpoint.currentBatch,
            lastProcessedId = checkpoint.lastProcessedSubmissionId
        )
        
        return true
    }
    
    fun createCheckpoint(syncJob: DataSyncJob) {
        val checkpoint = DataSyncCheckpoint(
            syncJobId = syncJob.id,
            userId = syncJob.userId,
            currentBatch = syncJob.currentBatch,
            totalBatches = syncJob.totalBatches,
            lastProcessedSubmissionId = syncJob.lastProcessedSubmissionId,
            collectedCount = syncJob.collectedCount,
            failedAttempts = syncJob.failedAttempts,
            checkpointAt = LocalDateTime.now(),
            canResume = syncJob.failedAttempts < 3
        )
        
        checkpointRepository.save(checkpoint)
    }
}
```

---

### **2. USER_REGISTRATION_SAGA**

**Î™©Ìëú**: Google OAuth2Î•º ÌÜµÌïú Ïã†Í∑ú ÏÇ¨Ïö©Ïûê Îì±Î°ùÍ≥º Ï¥àÍ∏∞ ÌîÑÎ°úÌïÑ ÏÑ§Ï†ï

#### **ÎπÑÏ¶àÎãàÏä§ ÏöîÍµ¨ÏÇ¨Ìï≠**
- Google OAuth2Î°ú Ïù∏Ï¶ùÎêú ÏÇ¨Ïö©ÏûêÎßå Í∞ÄÏûÖ Í∞ÄÎä•
- Í∞ÄÏûÖ Ï¶âÏãú Î∂ÑÏÑù ÌîÑÎ°úÌïÑÍ≥º ÏïåÎ¶º ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî
- Í∞ÄÏûÖ ÏôÑÎ£å Ïãú ÌôòÏòÅ Ïù¥Î©îÏùº Î∞úÏÜ°
- Î™®Îì† Îã®Í≥ÑÍ∞Ä ÏÑ±Í≥µÌï¥Ïïº Í∞ÄÏûÖ ÏôÑÎ£åÎ°ú Ï≤òÎ¶¨

#### **Saga ÌùêÎ¶ÑÎèÑ**

```mermaid
sequenceDiagram
    participant Client
    participant Google as Google OAuth2
    participant U as User Module
    participant A as Analysis Module
    participant N as Notification Module
    participant K as Kafka

    Note over Client,K: üîÑ USER_REGISTRATION_SAGA
    
    Client->>Google: OAuth2 Î°úÍ∑∏Ïù∏ ÏãúÏûë
    Google-->>Client: authorization_code
    Client->>U: POST /auth/register {authCode}
    
    rect rgb(255, 240, 240)
        Note over U: Step 1: ÏÇ¨Ïö©Ïûê Í≥ÑÏ†ï ÏÉùÏÑ±
        U->>Google: ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í≤ÄÏ¶ù
        Google-->>U: {email, name, picture}
        U->>U: Ï§ëÎ≥µ Ïù¥Î©îÏùº Ï≤¥ÌÅ¨
        U->>U: User ÏóîÌã∞Ìã∞ ÏÉùÏÑ± Î∞è Ï†ÄÏû•
        U->>U: JWT ÌÜ†ÌÅ∞ ÏÉùÏÑ±
        U->>U: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        U-->>K: USER_REGISTERED Î∞úÌñâ
    end
    
    rect rgb(240, 255, 240)
        Note over A: Step 2: Î∂ÑÏÑù ÌîÑÎ°úÌïÑ Ï¥àÍ∏∞Ìôî
        K->>A: USER_REGISTERED ÏàòÏã†
        A->>A: UserAnalysisProfile ÏÉùÏÑ±
        A->>A: Í∏∞Î≥∏ ÏÑ†Ìò∏ÎèÑ ÏÑ§Ï†ï
        A->>A: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: ANALYSIS_PROFILE_CREATED Î∞úÌñâ
    end
    
    rect rgb(240, 240, 255)
        Note over N: Step 3: ÏïåÎ¶º ÏÑ§Ï†ï Î∞è ÌôòÏòÅ Î©îÏãúÏßÄ
        K->>N: USER_REGISTERED ÏàòÏã†
        N->>N: NotificationSettings ÏÉùÏÑ±
        N->>N: ÌôòÏòÅ Ïù¥Î©îÏùº Î∞úÏÜ°
        N->>N: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        N-->>K: WELCOME_NOTIFICATION_SENT Î∞úÌñâ
    end
    
    U-->>Client: {token, userInfo} ÏùëÎãµ
```

#### **Ïù¥Î≤§Ìä∏ Î™ÖÏÑ∏**

##### `USER_REGISTERED`
```json
{
  "eventType": "USER_REGISTERED",
  "aggregateId": "user-{uuid}",
  "sagaId": "{saga-uuid}",
  "data": {
    "userId": "{uuid}",
    "email": "user@gmail.com",
    "nickname": "ÏïåÍ≥†ÎßàÏä§ÌÑ∞",
    "profileImageUrl": "https://lh3.googleusercontent.com/...",
    "provider": "GOOGLE"
  }
}
```

##### `ANALYSIS_PROFILE_CREATED`
```json
{
  "eventType": "ANALYSIS_PROFILE_CREATED", 
  "aggregateId": "analysis-profile-{uuid}",
  "sagaId": "{saga-uuid}",
  "data": {
    "userId": "{uuid}",
    "profileId": "{uuid}",
    "initializedAt": "2025-07-22T10:30:00Z"
  }
}
```

##### `WELCOME_NOTIFICATION_SENT`
```json
{
  "eventType": "WELCOME_NOTIFICATION_SENT",
  "aggregateId": "notification-{uuid}",
  "sagaId": "{saga-uuid}",
  "data": {
    "userId": "{uuid}",
    "notificationId": "{uuid}",
    "channel": "EMAIL",
    "sentAt": "2025-07-22T10:30:00Z"
  }
}
```

#### **Î≥¥ÏÉÅ Ìä∏ÎûúÏû≠ÏÖò**

```mermaid
sequenceDiagram
    participant U as User Module
    participant A as Analysis Module  
    participant N as Notification Module
    participant K as Kafka

    Note over U,K: üí• Step 2 Ïã§Ìå® ÏãúÎÇòÎ¶¨Ïò§
    
    rect rgb(255, 200, 200)
        Note over A: Analysis Profile ÏÉùÏÑ± Ïã§Ìå®
        A->>A: createAnalysisProfile() [FAILED]
        A->>A: OutboxÏóê Ïã§Ìå® Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: ANALYSIS_PROFILE_CREATION_FAILED Î∞úÌñâ
    end
    
    rect rgb(255, 200, 200)
        Note over U: Î≥¥ÏÉÅ: User ÏÇ≠Ï†ú
        K->>U: ANALYSIS_PROFILE_CREATION_FAILED ÏàòÏã†
        U->>U: ÏÉùÏÑ±Îêú User ÏÇ≠Ï†ú
        U->>U: JWT ÌÜ†ÌÅ∞ Î¨¥Ìö®Ìôî
        U->>U: OutboxÏóê Î≥¥ÏÉÅ Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        U-->>K: USER_REGISTRATION_CANCELLED Î∞úÌñâ
    end
```

---

### **2. SOLVEDAC_LINK_SAGA**

**Î™©Ìëú**: solved.ac Í≥ÑÏ†ï Ïó∞ÎèôÍ≥º Î™®Îì† Í¥ÄÎ†® ÏÑúÎπÑÏä§Ïùò Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî

#### **ÎπÑÏ¶àÎãàÏä§ ÏöîÍµ¨ÏÇ¨Ìï≠**
- solved.ac Ìï∏Îì§ Ïú†Ìö®ÏÑ± Í≤ÄÏ¶ù ÌïÑÏàò
- Ïó∞Îèô Ï¶âÏãú Ï†úÏ∂ú Ïù¥Î†• ÏàòÏßë ÏãúÏûë
- Ï∞∏Ïó¨ Ï§ëÏù∏ Ïä§ÌÑ∞Îîî Í∑∏Î£πÎì§Ïóê ÌîÑÎ°úÌïÑ ÏóÖÎç∞Ïù¥Ìä∏
- Ïó∞Îèô ÏôÑÎ£å ÏïåÎ¶º Î∞úÏÜ°

#### **Saga ÌùêÎ¶ÑÎèÑ**

```mermaid
sequenceDiagram
    participant Client
    participant U as User Module
    participant API as solved.ac API
    participant A as Analysis Module
    participant SG as StudyGroup Module
    participant N as Notification Module
    participant K as Kafka

    Note over Client,K: üîÑ SOLVEDAC_LINK_SAGA
    
    Client->>U: POST /users/me/link-solvedac {handle}
    
    rect rgb(255, 240, 240)
        Note over U: Step 1: Ìï∏Îì§ Í≤ÄÏ¶ù Î∞è Í≥ÑÏ†ï Ïó∞Îèô
        U->>API: solved.ac ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï°∞Ìöå
        API-->>U: {handle, tier, solvedCount, ...}
        U->>U: Ìï∏Îì§ Ï§ëÎ≥µ Ï≤¥ÌÅ¨
        U->>U: SolvedacUser ÏÉùÏÑ± Î∞è Ï†ÄÏû•
        U->>U: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        U-->>K: SOLVEDAC_LINKED Î∞úÌñâ
    end
    
    rect rgb(240, 255, 240)
        Note over A: Step 2: Ï†úÏ∂ú Ïù¥Î†• ÏàòÏßë ÏãúÏûë
        K->>A: SOLVEDAC_LINKED ÏàòÏã†
        A->>API: Ï†úÏ∂ú Ïù¥Î†• Ï°∞Ìöå (ÏµúÍ∑º 6Í∞úÏõî)
        API-->>A: submissions[]
        A->>A: Submissions ÏùºÍ¥Ñ Ï†ÄÏû•
        A->>A: Ï¥àÍ∏∞ Î∂ÑÏÑù Ïã§Ìñâ
        A->>A: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: SUBMISSION_SYNC_STARTED Î∞úÌñâ
    end
    
    rect rgb(240, 240, 255)
        Note over SG: Step 3: Ïä§ÌÑ∞Îîî Í∑∏Î£π ÌîÑÎ°úÌïÑ ÏóÖÎç∞Ïù¥Ìä∏
        K->>SG: SOLVEDAC_LINKED ÏàòÏã†
        SG->>SG: ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÜçÌïú Í∑∏Î£π Ï°∞Ìöå
        loop Í∞Å Í∑∏Î£πÎ≥ÑÎ°ú
            SG->>SG: GroupMemberProfile ÏóÖÎç∞Ïù¥Ìä∏
        end
        SG->>SG: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        SG-->>K: MEMBER_PROFILES_UPDATED Î∞úÌñâ
    end
    
    rect rgb(255, 255, 240)
        Note over N: Step 4: Ïó∞Îèô ÏôÑÎ£å ÏïåÎ¶º
        K->>N: SOLVEDAC_LINKED ÏàòÏã†
        N->>N: Ïó∞Îèô ÏÑ±Í≥µ ÏïåÎ¶º ÏÉùÏÑ±
        N->>N: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        N-->>K: LINK_COMPLETION_NOTIFICATION_SENT Î∞úÌñâ
    end
    
    U-->>Client: Ïó∞Îèô ÏôÑÎ£å ÏùëÎãµ
```

#### **Î≥¥ÏÉÅ Ìä∏ÎûúÏû≠ÏÖò (Î≥µÏû°Ìïú ÏãúÎÇòÎ¶¨Ïò§)**

```mermaid
sequenceDiagram
    participant U as User Module
    participant A as Analysis Module
    participant SG as StudyGroup Module
    participant K as Kafka

    Note over U,K: üí• Step 2 Ïã§Ìå® ÏãúÎÇòÎ¶¨Ïò§ (Ï†úÏ∂ú Ïù¥Î†• ÏàòÏßë Ïã§Ìå®)
    
    rect rgb(255, 200, 200)
        Note over A: Ï†úÏ∂ú Ïù¥Î†• ÏàòÏßë Ïã§Ìå®
        A->>A: fetchSubmissions() [API Ïò§Î•ò/ÌÉÄÏûÑÏïÑÏõÉ]
        A->>A: OutboxÏóê Ïã§Ìå® Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: SUBMISSION_SYNC_FAILED Î∞úÌñâ
    end
    
    rect rgb(255, 200, 200)
        Note over U: Î≥¥ÏÉÅ 1: solved.ac Ïó∞Îèô Ìï¥Ï†ú
        K->>U: SUBMISSION_SYNC_FAILED ÏàòÏã†
        U->>U: SolvedacUser ÏÇ≠Ï†ú
        U->>U: OutboxÏóê Î≥¥ÏÉÅ Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        U-->>K: SOLVEDAC_LINK_REVERTED Î∞úÌñâ
    end
    
    rect rgb(255, 200, 200)
        Note over SG: Î≥¥ÏÉÅ 2: Í∑∏Î£π ÌîÑÎ°úÌïÑ Î≥µÏõê
        K->>SG: SOLVEDAC_LINK_REVERTED ÏàòÏã†  
        SG->>SG: ÏóÖÎç∞Ïù¥Ìä∏Îêú ÌîÑÎ°úÌïÑ Î≥µÏõê
        SG->>SG: OutboxÏóê Î≥¥ÏÉÅ Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        SG-->>K: MEMBER_PROFILES_REVERTED Î∞úÌñâ
    end
```

---

### **3. CREATE_GROUP_SAGA**

**Î™©Ìëú**: Ïä§ÌÑ∞Îîî Í∑∏Î£π ÏÉùÏÑ±Í≥º Í∑∏Î£πÏû• ÏÑ§Ï†ï, Ï¥àÍ∏∞ ÌôòÍ≤Ω Íµ¨Ï∂ï

#### **Saga ÌùêÎ¶ÑÎèÑ**

```mermaid
sequenceDiagram
    participant Client
    participant SG as StudyGroup Module
    participant U as User Module
    participant A as Analysis Module
    participant N as Notification Module
    participant K as Kafka

    Note over Client,K: üîÑ CREATE_GROUP_SAGA
    
    Client->>SG: POST /studygroups {groupInfo}
    
    rect rgb(255, 240, 240)
        Note over SG: Step 1: Í∑∏Î£π ÏÉùÏÑ± Î∞è Í∑∏Î£πÏû• ÏÑ§Ï†ï
        SG->>SG: Í∑∏Î£πÏû• Í∂åÌïú Í≤ÄÏ¶ù
        SG->>SG: StudyGroup ÏÉùÏÑ±
        SG->>SG: Í∑∏Î£πÏû•ÏùÑ Ï≤´ Î≤àÏß∏ Î©§Î≤ÑÎ°ú Ï∂îÍ∞Ä
        SG->>SG: Ï¥àÎåÄ ÏΩîÎìú ÏÉùÏÑ± (ÎπÑÍ≥µÍ∞ú Í∑∏Î£π)
        SG->>SG: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        SG-->>K: STUDY_GROUP_CREATED Î∞úÌñâ
    end
    
    rect rgb(240, 255, 240)
        Note over U: Step 2: ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÌïÑ ÏóÖÎç∞Ïù¥Ìä∏
        K->>U: STUDY_GROUP_CREATED ÏàòÏã†
        U->>U: ÏÜåÏú† Í∑∏Î£π Î™©Î°ùÏóê Ï∂îÍ∞Ä
        U->>U: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        U-->>K: USER_GROUP_OWNERSHIP_UPDATED Î∞úÌñâ
    end
    
    rect rgb(240, 240, 255)
        Note over A: Step 3: Í∑∏Î£π Î∂ÑÏÑù ÌîÑÎ°úÌïÑ Ï¥àÍ∏∞Ìôî
        K->>A: STUDY_GROUP_CREATED ÏàòÏã†
        A->>A: GroupAnalyticsProfile ÏÉùÏÑ±
        A->>A: Í∑∏Î£πÏû• Í∞úÏù∏ Î∂ÑÏÑùÍ≥º Ïó∞Í≤∞
        A->>A: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: GROUP_ANALYTICS_INITIALIZED Î∞úÌñâ
    end
    
    rect rgb(255, 255, 240)
        Note over N: Step 4: Í∑∏Î£π ÏïåÎ¶º ÏÑ§Ï†ï
        K->>N: STUDY_GROUP_CREATED ÏàòÏã†
        N->>N: Í∑∏Î£π ÏïåÎ¶º ÏÑ§Ï†ï ÏÉùÏÑ±
        N->>N: Í∑∏Î£π ÏÉùÏÑ± ÌôïÏù∏ ÏïåÎ¶º Î∞úÏÜ°
        N->>N: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        N-->>K: GROUP_NOTIFICATION_SETUP_COMPLETED Î∞úÌñâ
    end
    
    SG-->>Client: Í∑∏Î£π ÏÉùÏÑ± ÏôÑÎ£å ÏùëÎãµ
```

---

### **4. JOIN_GROUP_SAGA**

**Î™©Ìëú**: ÏÇ¨Ïö©ÏûêÏùò Ïä§ÌÑ∞Îîî Í∑∏Î£π Ï∞∏Ïó¨ÏôÄ Î™®Îì† Í¥ÄÎ†® Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî

Ïù¥Îäî Í∞ÄÏû• Î≥µÏû°Ìïú Saga Ï§ë ÌïòÎÇòÎ°ú, Ïó¨Îü¨ Í≤ÄÏ¶ù Îã®Í≥ÑÏôÄ Î≥¥ÏÉÅ Î°úÏßÅÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.

#### **Saga ÌùêÎ¶ÑÎèÑ**

```mermaid
sequenceDiagram
    participant Client
    participant SG as StudyGroup Module
    participant U as User Module
    participant A as Analysis Module
    participant N as Notification Module
    participant K as Kafka

    Note over Client,K: üîÑ JOIN_GROUP_SAGA (Í∞ÄÏû• Î≥µÏû°Ìïú Saga)
    
    Client->>SG: POST /studygroups/{id}/join
    
    rect rgb(255, 240, 240)
        Note over SG: Step 1: Í∑∏Î£π Ï†ïÏõê Ï≤¥ÌÅ¨ & ÏûÑÏãú ÏòàÏïΩ
        SG->>SG: Í∑∏Î£π Ï°¥Ïû¨ Ïó¨Î∂Ä ÌôïÏù∏
        SG->>SG: ÏµúÎåÄ Ïù∏Ïõê Ï≤¥ÌÅ¨
        SG->>SG: ÏûÑÏãú Î©§Î≤Ñ ÏòàÏïΩ ÏÉùÏÑ± (5Î∂Ñ TTL)
        SG->>SG: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        SG-->>K: USER_VALIDATION_REQUESTED Î∞úÌñâ
    end
    
    rect rgb(240, 255, 240)
        Note over U: Step 2: ÏÇ¨Ïö©Ïûê ÏûêÍ≤© Í≤ÄÏ¶ù
        K->>U: USER_VALIDATION_REQUESTED ÏàòÏã†
        U->>U: ÏÇ¨Ïö©Ïûê ÌôúÏÑ± ÏÉÅÌÉú ÌôïÏù∏
        U->>U: solved.ac Ïó∞Îèô ÏÉÅÌÉú ÌôïÏù∏ (ÏÑ†ÌÉùÏ†Å)
        U->>U: Ïù¥ÎØ∏ Ï∞∏Ïó¨Ìïú Í∑∏Î£πÏù∏ÏßÄ ÌôïÏù∏
        U->>U: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        U-->>K: USER_VALIDATED Î∞úÌñâ
    end
    
    rect rgb(240, 240, 255)
        Note over SG: Step 3: Ï†ïÏãù Î©§Î≤Ñ Ï†ÑÌôò
        K->>SG: USER_VALIDATED ÏàòÏã†
        SG->>SG: ÏûÑÏãú ÏòàÏïΩÏùÑ Ï†ïÏãù Î©§Î≤ÑÎ°ú Ï†ÑÌôò
        SG->>SG: Î©§Î≤Ñ Ïàò Ï¶ùÍ∞Ä
        SG->>SG: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        SG-->>K: MEMBER_JOINED Î∞úÌñâ
    end
    
    rect rgb(255, 240, 255)
        Note over A: Step 4: Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî
        K->>A: MEMBER_JOINED ÏàòÏã†
        A->>A: ÏÇ¨Ïö©Ïûê Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞Î•º Í∑∏Î£πÏóê ÎèôÍ∏∞Ìôî
        A->>A: Í∑∏Î£π ÌÜµÍ≥Ñ Ïû¨Í≥ÑÏÇ∞
        A->>A: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: MEMBER_ANALYSIS_SYNCED Î∞úÌñâ
    end
    
    rect rgb(255, 255, 240)
        Note over N: Step 5: ÌôòÏòÅ ÏïåÎ¶º Î∞úÏÜ°
        K->>N: MEMBER_JOINED ÏàòÏã†
        N->>N: Í∑∏Î£πÏû•ÏóêÍ≤å ÏÉà Î©§Î≤Ñ ÏïåÎ¶º
        N->>N: Ï∞∏Ïó¨ÏûêÏóêÍ≤å ÌôòÏòÅ ÏïåÎ¶º
        N->>N: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        N-->>K: WELCOME_NOTIFICATIONS_SENT Î∞úÌñâ
    end
    
    SG-->>Client: Ï∞∏Ïó¨ ÏôÑÎ£å ÏùëÎãµ
```

#### **Î≥µÏû°Ìïú Î≥¥ÏÉÅ ÏãúÎÇòÎ¶¨Ïò§Îì§**

##### **ÏãúÎÇòÎ¶¨Ïò§ 1: ÏÇ¨Ïö©Ïûê Í≤ÄÏ¶ù Ïã§Ìå®**

```mermaid
sequenceDiagram
    participant SG as StudyGroup Module
    participant U as User Module
    participant K as Kafka

    rect rgb(255, 200, 200)
        Note over U: Step 2ÏóêÏÑú Í≤ÄÏ¶ù Ïã§Ìå®
        U->>U: validateUser() [ÎπÑÌôúÏÑ± ÏÇ¨Ïö©Ïûê]
        U->>U: OutboxÏóê Ïã§Ìå® Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        U-->>K: USER_VALIDATION_FAILED Î∞úÌñâ
    end
    
    rect rgb(255, 200, 200)
        Note over SG: Î≥¥ÏÉÅ: ÏûÑÏãú ÏòàÏïΩ ÏÇ≠Ï†ú
        K->>SG: USER_VALIDATION_FAILED ÏàòÏã†
        SG->>SG: ÏûÑÏãú Î©§Î≤Ñ ÏòàÏïΩ ÏÇ≠Ï†ú
        SG->>SG: OutboxÏóê Î≥¥ÏÉÅ Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        SG-->>K: JOIN_GROUP_CANCELLED Î∞úÌñâ
    end
```

##### **ÏãúÎÇòÎ¶¨Ïò§ 2: Î∂ÑÏÑù ÎèôÍ∏∞Ìôî Ïã§Ìå®**

```mermaid
sequenceDiagram
    participant SG as StudyGroup Module
    participant U as User Module
    participant A as Analysis Module
    participant K as Kafka

    rect rgb(255, 200, 200)
        Note over A: Step 4ÏóêÏÑú Î∂ÑÏÑù ÎèôÍ∏∞Ìôî Ïã§Ìå®
        A->>A: syncMemberAnalysis() [DB Ïò§Î•ò]
        A->>A: OutboxÏóê Ïã§Ìå® Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: MEMBER_ANALYSIS_SYNC_FAILED Î∞úÌñâ
    end
    
    rect rgb(255, 200, 200)
        Note over SG: Î≥¥ÏÉÅ 1: Î©§Î≤Ñ Ï†úÍ±∞
        K->>SG: MEMBER_ANALYSIS_SYNC_FAILED ÏàòÏã†
        SG->>SG: Ï∂îÍ∞ÄÎêú Î©§Î≤Ñ Ï†úÍ±∞
        SG->>SG: Î©§Î≤Ñ Ïàò Í∞êÏÜå
        SG->>SG: OutboxÏóê Î≥¥ÏÉÅ Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        SG-->>K: MEMBER_REMOVED_DUE_TO_SYNC_FAILURE Î∞úÌñâ
    end
    
    rect rgb(255, 200, 200)
        Note over U: Î≥¥ÏÉÅ 2: ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÌïÑ Î≥µÏõê
        K->>U: MEMBER_REMOVED_DUE_TO_SYNC_FAILURE ÏàòÏã†
        U->>U: Ï∞∏Ïó¨ Í∑∏Î£π Î™©Î°ùÏóêÏÑú Ï†úÍ±∞
        U->>U: OutboxÏóê Î≥¥ÏÉÅ Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        U-->>K: USER_GROUP_MEMBERSHIP_REVERTED Î∞úÌñâ
    end
```

---

### **5. SUBMISSION_SYNC_SAGA**

**Î™©Ìëú**: solved.acÏóêÏÑú ÏÉàÎ°úÏö¥ Ï†úÏ∂ú Îç∞Ïù¥ÌÑ∞Î•º ÏàòÏßëÌïòÏó¨ Ï†ÑÏ≤¥ ÏãúÏä§ÌÖúÏóê ÎèôÍ∏∞Ìôî

#### **Saga ÌùêÎ¶ÑÎèÑ**

```mermaid
sequenceDiagram
    participant Scheduler as Data Collector
    participant API as solved.ac API
    participant A as Analysis Module
    participant SG as StudyGroup Module
    participant N as Notification Module
    participant K as Kafka

    Note over Scheduler,K: üîÑ SUBMISSION_SYNC_SAGA (5Î∂ÑÎßàÎã§ Ïã§Ìñâ)
    
    Scheduler->>A: triggerSubmissionSync()
    A->>API: Ïó∞ÎèôÎêú ÏÇ¨Ïö©ÏûêÎì§Ïùò ÏµúÏã† Ï†úÏ∂ú Ï°∞Ìöå
    API-->>A: newSubmissions[]
    
    loop Í∞Å ÏÉà Ï†úÏ∂úÎ≥ÑÎ°ú
        rect rgb(255, 240, 240)
            Note over A: Step 1: Ï†úÏ∂ú Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Î∞è Î∂ÑÏÑù
            A->>A: Submission ÏóîÌã∞Ìã∞ Ï†ÄÏû•
            A->>A: Î¨∏Ï†ú Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            A->>A: ÏÇ¨Ïö©Ïûê Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞ Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
            A->>A: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
            A-->>K: SUBMISSION_PROCESSED Î∞úÌñâ
        end
        
        rect rgb(240, 255, 240)
            Note over SG: Step 2: Í∑∏Î£π ÌôúÎèô ÏóÖÎç∞Ïù¥Ìä∏
            K->>SG: SUBMISSION_PROCESSED ÏàòÏã†
            SG->>SG: Î©§Î≤Ñ ÌôúÎèô Í∏∞Î°ù ÏóÖÎç∞Ïù¥Ìä∏
            SG->>SG: Ìï†ÎãπÎêú Î¨∏Ï†ú ÏôÑÎ£å Ï≤¥ÌÅ¨
            SG->>SG: Í∑∏Î£π ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            SG->>SG: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
            SG-->>K: MEMBER_ACTIVITY_UPDATED Î∞úÌñâ
        end
        
        rect rgb(240, 240, 255)
            Note over N: Step 3: ÏÑ±Ï∑® ÏïåÎ¶º Ï≤¥ÌÅ¨
            K->>N: MEMBER_ACTIVITY_UPDATED ÏàòÏã†
            N->>N: Ïó∞ÏÜç Ìï¥Í≤∞ Í∏∞Î°ù Ï≤¥ÌÅ¨
            N->>N: Ìï†Îãπ Î¨∏Ï†ú ÏôÑÎ£å ÏïåÎ¶º
            alt ÌäπÎ≥ÑÌïú ÏÑ±Ï∑® Îã¨ÏÑ±
                N->>N: ÏÑ±Ï∑® ÏïåÎ¶º ÏÉùÏÑ±
                N->>N: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
                N-->>K: ACHIEVEMENT_NOTIFICATION_SENT Î∞úÌñâ
            end
        end
    end
```

---

### **6. ANALYSIS_UPDATE_SAGA**

**Î™©Ìëú**: Ï†ïÍ∏∞Ï†ÅÏù∏ ÏÇ¨Ïö©Ïûê/Í∑∏Î£π Î∂ÑÏÑù Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏ÏôÄ Ï∂îÏ≤ú Í∞±Ïã†

#### **Saga ÌùêÎ¶ÑÎèÑ**

```mermaid  
sequenceDiagram
    participant Scheduler
    participant A as Analysis Module
    participant SG as StudyGroup Module
    participant N as Notification Module
    participant K as Kafka

    Note over Scheduler,K: üîÑ ANALYSIS_UPDATE_SAGA (ÏùºÍ∞Ñ Ïã§Ìñâ)
    
    Scheduler->>A: triggerDailyAnalysisUpdate()
    
    rect rgb(255, 240, 240)
        Note over A: Step 1: Î∂ÑÏÑù Í≤∞Í≥º ÏÉùÏÑ±
        A->>A: Ïñ¥Ï†ú Ï†úÏ∂ú Îç∞Ïù¥ÌÑ∞ ÏßëÍ≥Ñ
        A->>A: ÌÉúÍ∑∏Î≥Ñ ÏàôÎ†®ÎèÑ Ïû¨Í≥ÑÏÇ∞
        A->>A: Ï∑®ÏïΩÏ†ê/Í∞ïÏ†ê Î∂ÑÏÑù ÏóÖÎç∞Ïù¥Ìä∏
        A->>A: Í∞úÏù∏ ÎßûÏ∂§ Ï∂îÏ≤ú ÏÉùÏÑ±
        A->>A: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        A-->>K: ANALYSIS_UPDATED Î∞úÌñâ
    end
    
    rect rgb(240, 255, 240)
        Note over SG: Step 2: Í∑∏Î£π Î∂ÑÏÑù ÏóÖÎç∞Ïù¥Ìä∏
        K->>SG: ANALYSIS_UPDATED ÏàòÏã†
        SG->>SG: Î©§Î≤Ñ ÌîÑÎ°úÌïÑ ÎèôÍ∏∞Ìôî
        SG->>SG: Í∑∏Î£π Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ Ïû¨Í≥ÑÏÇ∞
        SG->>SG: Í∑∏Î£π Í∞ïÏ†ê/ÏïΩÏ†ê Î∂ÑÏÑù
        SG->>SG: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
        SG-->>K: GROUP_ANALYSIS_UPDATED Î∞úÌñâ
    end
    
    rect rgb(240, 240, 255)
        Note over N: Step 3: ÏßÑÏ†Ñ ÏÉÅÌô© ÏïåÎ¶º
        K->>N: ANALYSIS_UPDATED ÏàòÏã†
        N->>N: Ï£ºÏöî Ìñ•ÏÉÅ ÏÇ¨Ìï≠ Í∞êÏßÄ
        alt ÎààÏóê ÎùÑÎäî Î∞úÏ†Ñ ÏûàÏùå
            N->>N: Í∞úÏù∏ ÏßÑÏ†Ñ ÏïåÎ¶º ÏÉùÏÑ±
            N->>N: OutboxÏóê Ïù¥Î≤§Ìä∏ Ï†ÄÏû•
            N-->>K: PROGRESS_NOTIFICATION_SENT Î∞úÌñâ
        end
    end
```

---

## üéØ **Íµ¨ÌòÑ ÏàúÏÑú Î∞è ÌÖåÏä§Ìä∏ Ï†ÑÎûµ**

### **1Îã®Í≥Ñ: Í∏∞Î≥∏ Ïù∏ÌîÑÎùº**
1. ‚úÖ Outbox Pattern Í∏∞Î≥∏ Íµ¨ÌòÑ
2. ‚úÖ Saga Coordinator Ïù∏ÌÑ∞ÌéòÏù¥Ïä§
3. ‚úÖ Í∏∞Î≥∏ Ïù¥Î≤§Ìä∏ Î∞úÌñâ/Íµ¨ÎèÖ Íµ¨Ï°∞

### **2Îã®Í≥Ñ: Îç∞Ïù¥ÌÑ∞ ÌååÏù¥ÌîÑÎùºÏù∏ Íµ¨Ï∂ï (NEXT_TASKS.md Phase 1 Ïö∞ÏÑ†ÏàúÏúÑ)**
1. ‚úÖ `INITIAL_DATA_SYNC_SAGA` - **ÏµúÏö∞ÏÑ† Íµ¨ÌòÑ** (ÎåÄÏö©Îüâ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë)
2. ‚úÖ `SUBMISSION_SYNC_SAGA` - Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî

### **3Îã®Í≥Ñ: ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ Í∏∞Î∞ò Íµ¨Ï∂ï**
3. ‚úÖ `USER_REGISTRATION_SAGA` - Í∞ÄÏû• Îã®ÏàúÌïú 3Îã®Í≥Ñ Saga
4. ‚úÖ `SOLVEDAC_LINK_SAGA` - INITIAL_DATA_SYNC_SAGAÏôÄ Ïó∞Í≥Ñ

### **4Îã®Í≥Ñ: Í∑∏Î£π Í¥ÄÎ¶¨ Í∏∞Îä•**
5. ‚úÖ `CREATE_GROUP_SAGA` - 4Îã®Í≥Ñ SagaÎ°ú Î≥µÏû°ÎèÑ Ï¶ùÍ∞Ä
6. ‚úÖ `JOIN_GROUP_SAGA` - Í∞ÄÏû• Î≥µÏû°Ìïú 5Îã®Í≥Ñ Î≥¥ÏÉÅ Î°úÏßÅ

### **5Îã®Í≥Ñ: Î∂ÑÏÑù Î∞è ÏµúÏ†ÅÌôî**
7. ‚úÖ `ANALYSIS_UPDATE_SAGA` - ÎåÄÏö©Îüâ Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨

### **ÌÖåÏä§Ìä∏ Ï†ÑÎûµ**

```kotlin
// Í∞Å SagaÎ≥Ñ ÌÖåÏä§Ìä∏ ÌÅ¥ÎûòÏä§ ÏòàÏãú
@SpringBootTest
@TestPropertySource(properties = ["kafka.enabled=false"])
class UserRegistrationSagaTest {
    
    @Test
    fun `ÏÇ¨Ïö©Ïûê Îì±Î°ù Saga ÏÑ±Í≥µ ÏãúÎÇòÎ¶¨Ïò§`() {
        // Given: OAuth2 Ïù∏Ï¶ù ÏΩîÎìúÏôÄ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥
        val authCode = "mock_auth_code"
        val expectedUserInfo = createMockUserInfo()
        
        // When: ÌöåÏõêÍ∞ÄÏûÖ ÏöîÏ≤≠
        val result = userRegistrationSaga.start(authCode)
        
        // Then: Î™®Îì† Îã®Í≥Ñ ÏôÑÎ£å ÌôïÏù∏
        assertThat(result.sagaStatus).isEqualTo(SagaStatus.COMPLETED)
        assertThat(userRepository.findByEmail(expectedUserInfo.email)).isNotNull()
        assertThat(analysisService.hasProfile(result.userId)).isTrue()
        assertThat(notificationService.hasSettings(result.userId)).isTrue()
    }
    
    @Test
    fun `Î∂ÑÏÑù ÌîÑÎ°úÌïÑ ÏÉùÏÑ± Ïã§Ìå® Ïãú Î≥¥ÏÉÅ Ìä∏ÎûúÏû≠ÏÖò Ïã§Ìñâ`() {
        // Given: Î∂ÑÏÑù ÏÑúÎπÑÏä§ Ïû•Ïï† ÏÉÅÌô©
        whenever(analysisService.createProfile(any())).thenThrow(RuntimeException("DB Error"))
        
        // When: ÌöåÏõêÍ∞ÄÏûÖ ÏãúÎèÑ
        val result = userRegistrationSaga.start("auth_code")
        
        // Then: Saga Ïã§Ìå® Î∞è Î≥¥ÏÉÅ Ïã§Ìñâ ÌôïÏù∏
        assertThat(result.sagaStatus).isEqualTo(SagaStatus.COMPENSATED)
        assertThat(userRepository.findByEmail(any())).isNull() // ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†úÎê®
    }
}
```

---

üìù **Î¨∏ÏÑú Î≤ÑÏ†Ñ**: v1.0  
üìÖ **ÏµúÏ¢Ö ÏàòÏ†ïÏùº**: 2025-07-22  
üë§ **ÏûëÏÑ±Ïûê**: Ï±ÑÍ∏∞Ìõà